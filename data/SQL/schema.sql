DROP DATABASE IF EXISTS taskforce;
CREATE DATABASE taskforce CHARACTER SET = utf8;
USE taskforce;

CREATE TABLE CATEGORIES 
(
ID INT AUTO_INCREMENT PRIMARY KEY,
CHARACTER_CODE INT UNIQUE,
CATEGORY TEXT NOT NULL,
ICON VARCHAR(255)
);

CREATE TABLE CITIES 
(
ID INT AUTO_INCREMENT PRIMARY KEY,
CITY TEXT,
LATITUDE DECIMAL(18, 7),
LONGDITUDE DECIMAL(18, 7) 
);

CREATE TABLE STATUSES
(
ID INT AUTO_INCREMENT PRIMARY KEY,
STATUS TEXT
);

CREATE TABLE USERS 
(
ID INT AUTO_INCREMENT PRIMARY KEY,
REGISTRATION_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
NAME TEXT NOT NULL,
PASSWORD VARCHAR(255) NOT NULL,
EMAIL VARCHAR(255) NOT NULL UNIQUE,
PICTURE VARCHAR(255),
BIRTHDAY DATETIME,
PHONE_NUMBER INT,
TELEGRAM VARCHAR(255),
ABOUT TEXT,
CITY_ID INT NOT NULL,
FOREIGN KEY (CITY_ID) REFERENCES CITIES(ID)
);

CREATE TABLE TASKS 
(
ID INT AUTO_INCREMENT PRIMARY KEY,
PUBLICATION_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
TITLE TEXT NOT NULL,
DESCRIPTION TEXT NOT NULL,
BUDGET INT,
FILES VARCHAR(255),
STATUS_ID INT,
EXECUTION_DATE DATETIME,
CATEGORY_ID INT NOT NULL,
CUSTOMER_ID INT NOT NULL,
EXECUTIONER_ID INT,
CITY_ID INT,
FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES(ID),
FOREIGN KEY (CUSTOMER_ID) REFERENCES USERS(ID),
FOREIGN KEY (EXECUTIONER_ID) REFERENCES USERS(ID),
FOREIGN KEY (CITY_ID) REFERENCES CITIES(ID),
FOREIGN KEY (STATUS_ID) REFERENCES STATUSES(ID)
);

CREATE TABLE RATINGS 
(
ID INT AUTO_INCREMENT PRIMARY KEY,
RATED_USER INT,
RATING_USER INT,
SCORE INT,
TASK_ID INT,
DT_ADD DATETIME DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (RATED_USER) REFERENCES USERS(ID),
FOREIGN KEY (RATING_USER) REFERENCES USERS(ID),
FOREIGN KEY (TASK_ID) REFERENCES TASKS(ID)
);

SET GLOBAL max_allowed_packet=524288000;


